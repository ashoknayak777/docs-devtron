"use strict";(self.webpackChunkdocdevtron=self.webpackChunkdocdevtron||[]).push([[8102],{5381:(e,i,n)=>{n.r(i),n.d(i,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>r,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"user-guide/global-configurations/filter-condition","title":"Filter Condition","description":"Introduction","source":"@site/docs/user-guide/global-configurations/filter-condition.md","sourceDirName":"user-guide/global-configurations","slug":"/user-guide/global-configurations/filter-condition","permalink":"/docs/user-guide/global-configurations/filter-condition","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Tags Policy","permalink":"/docs/user-guide/global-configurations/tags-policy"},"next":{"title":"Lock Deployment Configuration","permalink":"/docs/user-guide/global-configurations/lock-deployment-config"}}');var t=n(4848),o=n(8453);const r={},l="Filter Condition",a={},c=[{value:"Introduction <a></a>",id:"introduction-",level:2},{value:"Steps to Create a Filter",id:"steps-to-create-a-filter",level:2},{value:"Examples",id:"examples",level:2},{value:"Pass Condition",id:"pass-condition",level:3},{value:"Scenario 1",id:"scenario-1",level:4},{value:"Scenario 2",id:"scenario-2",level:4},{value:"Fail Condition",id:"fail-condition",level:3}];function d(e){const i={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",img:"img",li:"li",mdxAdmonitionTitle:"mdxAdmonitionTitle",ol:"ol",p:"p",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(i.header,{children:(0,t.jsx)(i.h1,{id:"filter-condition",children:"Filter Condition"})}),"\n",(0,t.jsxs)(i.h2,{id:"introduction-",children:["Introduction ",(0,t.jsx)("a",{href:"https://devtron.ai/pricing",children:(0,t.jsx)("img",{src:"https://devtron-public-asset.s3.us-east-2.amazonaws.com/images/elements/EnterpriseTag.svg",className:"enterprise-badge-img"})})]}),"\n",(0,t.jsxs)(i.p,{children:["The ",(0,t.jsx)(i.a,{href:"../creating-application/workflow/",children:"workflows"})," you create in Devtron for managing the CI-CD of your application can be made flexible or restricting with the help of CD filter conditions, for e.g., not all events (such as image builds) generated during the CI stage require progression to the CD stage. Therefore, instead of creating multiple workflows that cater to complex requirements, Devtron provides you the option of defining filters to tailor your workflow according to your specific needs."]}),"\n",(0,t.jsx)(i.p,{children:"Using filter conditions, you can control the progression of events. Here are a few general examples:"}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsx)(i.li,{children:'Images containing the label "test" should not be eligible for deployment in production environment'}),"\n",(0,t.jsx)(i.li,{children:"Only images having tag versions greater than v0.7.4 should be eligible for deployment"}),"\n",(0,t.jsx)(i.li,{children:"Images hosted on Docker Hub should be eligible but not the rest"}),"\n",(0,t.jsxs)(i.li,{children:["Only images derived from master branch should be eligible for production deployment (see ",(0,t.jsx)(i.a,{href:"#scenario-2",children:"example"}),")"]}),"\n"]}),"\n",(0,t.jsx)(i.hr,{}),"\n",(0,t.jsx)(i.h2,{id:"steps-to-create-a-filter",children:"Steps to Create a Filter"}),"\n",(0,t.jsx)(i.admonition,{title:"Prerequisites",type:"info",children:(0,t.jsx)(i.p,{children:"You must have application(s) with CI-CD workflow(s) configured"})}),"\n",(0,t.jsxs)(i.ol,{children:["\n",(0,t.jsxs)(i.li,{children:["\n",(0,t.jsxs)(i.p,{children:["From the left sidebar, go to ",(0,t.jsx)(i.strong,{children:"Application Management"})," \u2192 ",(0,t.jsx)(i.strong,{children:"Policies"})," \u2192 ",(0,t.jsx)(i.strong,{children:"Filter Condition"}),"."]}),"\n"]}),"\n",(0,t.jsxs)(i.li,{children:["\n",(0,t.jsx)(i.p,{children:"Add a filter condition."}),"\n",(0,t.jsx)(i.p,{children:(0,t.jsx)(i.img,{src:"https://devtron-public-asset.s3.us-east-2.amazonaws.com/images/global-configurations/filters/add-filter.jpg",alt:"Figure 1: Creating Our First Filter"})}),"\n"]}),"\n",(0,t.jsxs)(i.li,{children:["\n",(0,t.jsxs)(i.p,{children:["In the ",(0,t.jsx)(i.strong,{children:"Define Filter condition"})," section, you get the following fields:"]}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Filter For"}),": Choose the pipeline upon which the filter should apply. Currently, you can use filter conditions for CD pipelines only. Support for CI pipelines is underway."]}),"\n"]}),"\n",(0,t.jsx)(i.p,{children:(0,t.jsx)(i.img,{src:"https://devtron-public-asset.s3.us-east-2.amazonaws.com/images/global-configurations/filters/define-filter-page.jpg",alt:"Figure 2: 'Define Filter Condition' section"})}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:["\n",(0,t.jsxs)(i.p,{children:[(0,t.jsx)(i.strong,{children:"Filter Name"}),": Give a name to the filter."]}),"\n"]}),"\n",(0,t.jsxs)(i.li,{children:["\n",(0,t.jsxs)(i.p,{children:[(0,t.jsx)(i.strong,{children:"Description"}),": (Optional) Add a description to the filter, preferably explaining what it does."]}),"\n"]}),"\n",(0,t.jsxs)(i.li,{children:["\n",(0,t.jsxs)(i.p,{children:[(0,t.jsx)(i.strong,{children:"Filter Condition"}),": You can specify either a pass condition, fail condition, or both the conditions:"]}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Pass Condition"}),": Events that satisfy the pass condition are eligible to trigger your CD pipeline."]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Fail Condition"}),": Events that satisfy the fail condition are not eligible to trigger your CD pipeline."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(i.li,{children:["\n",(0,t.jsxs)(i.p,{children:[(0,t.jsx)(i.strong,{children:"Use CEL Expression"}),": You can use ",(0,t.jsx)(i.code,{children:"Common Expression Language"})," (CEL) to define the conditions. Currently, you can create conditions with the help of following variables:"]}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"containerImage"}),": Package that contains all the necessary files and instructions to run an application in a container, e.g., gcr.io/k8s-minikube/kicbase",":v0",".0.39. It returns a string value in the following format: ",(0,t.jsx)(i.code,{children:"<registry>/<repository>:<tag>"})]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"containerRepository"}),": Storage location for container images, e.g., kicbase"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"containerImageTag"}),": Versioning of image to indicate its release, e.g., v0.0.39"]}),"\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"imageLabels"}),': The label(s) you assign to an image in the CD pipeline, e.g., ["PROD","Stage"]. It returns an array of strings.']}),"\n"]}),"\n",(0,t.jsxs)(i.p,{children:["Click ",(0,t.jsx)(i.strong,{children:"View filter criteria"})," to check the supported criteria. You get a copy button and a description of each criterion upon hovering. Moreover, you can go to ",(0,t.jsx)(i.strong,{children:"CEL expression"})," to learn more about the rules and supported syntax. Check ",(0,t.jsx)(i.a,{href:"#examples",children:"Examples"})," to know more."]}),"\n",(0,t.jsx)(i.p,{children:(0,t.jsx)(i.img,{src:"https://devtron-public-asset.s3.us-east-2.amazonaws.com/images/global-configurations/filters/filter-criteria.jpg",alt:"Figure 3: List of Supported Values"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(i.li,{children:["\n",(0,t.jsxs)(i.p,{children:["Click ",(0,t.jsx)(i.strong,{children:"Next"}),"."]}),"\n"]}),"\n",(0,t.jsxs)(i.li,{children:["\n",(0,t.jsxs)(i.p,{children:["In the ",(0,t.jsx)(i.strong,{children:"Apply to"})," section, you get the following fields:"]}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Application"}),": Choose one or more applications to which your filter condition must apply."]}),"\n"]}),"\n",(0,t.jsx)(i.p,{children:(0,t.jsx)(i.img,{src:"https://devtron-public-asset.s3.us-east-2.amazonaws.com/images/global-configurations/filters/app-selection.jpg",alt:"Figure 4: Selecting Application(s)"})}),"\n",(0,t.jsxs)(i.ul,{children:["\n",(0,t.jsxs)(i.li,{children:[(0,t.jsx)(i.strong,{children:"Environment"}),": Choose one or more environments to which your filter condition must apply."]}),"\n"]}),"\n",(0,t.jsx)(i.p,{children:(0,t.jsx)(i.img,{src:"https://devtron-public-asset.s3.us-east-2.amazonaws.com/images/global-configurations/filters/environment-selection.jpg",alt:"Figure 5: Selecting Environment(s) from Cluster(s)"})}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(i.admonition,{type:"info",children:[(0,t.jsx)(i.mdxAdmonitionTitle,{}),(0,t.jsxs)(i.p,{children:["Since an application can have more than one environment, the filter conditions apply only to the environment you chose in the ",(0,t.jsx)(i.strong,{children:"Apply to"})," section. If you create a filter condition without choosing an application or environment, it will not apply to any of your pipelines."]})]}),"\n",(0,t.jsxs)(i.ol,{start:"6",children:["\n",(0,t.jsxs)(i.li,{children:["\n",(0,t.jsxs)(i.p,{children:["Click ",(0,t.jsx)(i.strong,{children:"Save"}),". You have successfully created a filter."]}),"\n",(0,t.jsx)(i.p,{children:(0,t.jsx)(i.img,{src:"https://devtron-public-asset.s3.us-east-2.amazonaws.com/images/global-configurations/filters/filter-created.jpg",alt:"Figure 6: Success Toast"})}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(i.admonition,{type:"caution",children:[(0,t.jsx)(i.mdxAdmonitionTitle,{}),(0,t.jsx)(i.p,{children:"If you create filters using CEL expressions that result in a conflict (i.e., passing and failing of the same image), fail will have higher precedence"})]}),"\n",(0,t.jsx)(i.hr,{}),"\n",(0,t.jsx)(i.h2,{id:"examples",children:"Examples"}),"\n",(0,t.jsxs)(i.p,{children:["Here's a sample pipeline we will be using for our explanation of ",(0,t.jsx)(i.a,{href:"#pass-condition",children:"pass condition"})," and ",(0,t.jsx)(i.a,{href:"#fail-condition",children:"fail condition"}),"."]}),"\n",(0,t.jsx)(i.p,{children:(0,t.jsx)(i.img,{src:"https://devtron-public-asset.s3.us-east-2.amazonaws.com/images/global-configurations/filters/sample-workflow.jpg",alt:"Figure 7: Sample Pipeline"})}),"\n",(0,t.jsx)(i.h3,{id:"pass-condition",children:"Pass Condition"}),"\n",(0,t.jsx)(i.h4,{id:"scenario-1",children:"Scenario 1"}),"\n",(0,t.jsxs)(i.p,{children:["Consider a scenario where you wish to make an image eligible for deployment only if its tag version is greater than ",(0,t.jsx)(i.code,{children:"v0.0.7"})]}),"\n",(0,t.jsxs)(i.p,{children:["The CEL Expression should be ",(0,t.jsx)(i.code,{children:'containerImageTag > "v0.0.7"'})]}),"\n",(0,t.jsx)(i.p,{children:(0,t.jsx)(i.img,{src:"https://devtron-public-asset.s3.us-east-2.amazonaws.com/images/global-configurations/filters/pass-condition-1.jpg",alt:"Figure 8: CEL Expression for Pass Condition"})}),"\n",(0,t.jsxs)(i.p,{children:["Go to the ",(0,t.jsx)(i.strong,{children:"Build & Deploy"})," tab. The filter condition was created specifically for ",(0,t.jsx)(i.code,{children:"test"})," environment, therefore the filter condition would be evaluated only at the relevant CD pipeline, i.e., ",(0,t.jsx)(i.code,{children:"test"})]}),"\n",(0,t.jsx)(i.p,{children:(0,t.jsx)(i.img,{src:"https://devtron-public-asset.s3.us-east-2.amazonaws.com/images/global-configurations/filters/pass-env.jpg",alt:"Figure 9: Build & Deploy tab"})}),"\n",(0,t.jsxs)(i.p,{children:["Click ",(0,t.jsx)(i.strong,{children:"Select Image"})," for the ",(0,t.jsx)(i.code,{children:"test"})," CD pipeline. The first tab ",(0,t.jsx)(i.strong,{children:"Eligible images"})," shows the list and count of images that have satisfied the pass condition since their tag versions were greater than ",(0,t.jsx)(i.code,{children:"v0.0.7"}),". Hence, they are marked eligible for deployment."]}),"\n",(0,t.jsx)(i.p,{children:(0,t.jsx)(i.img,{src:"https://devtron-public-asset.s3.us-east-2.amazonaws.com/images/global-configurations/filters/eligible-list-1.jpg",alt:"Figure 10: List of Eligible Images"})}),"\n",(0,t.jsxs)(i.p,{children:["The second tab ",(0,t.jsx)(i.strong,{children:"Latest images"})," shows the latest builds (up to 10 images) irrespective of whether they have satisfied the filter condition(s) or not. The ones that have not satisfied the filter conditions get marked as ",(0,t.jsx)(i.code,{children:"Excluded"}),". In other words, they are not eligible for deployment."]}),"\n",(0,t.jsx)(i.p,{children:(0,t.jsx)(i.img,{src:"https://devtron-public-asset.s3.us-east-2.amazonaws.com/images/global-configurations/filters/latest-list-1.jpg",alt:"Figure 11: List of Latest Images"})}),"\n",(0,t.jsxs)(i.p,{children:["Clicking the filter icon at the top-left shows the filter condition(s) applied to the ",(0,t.jsx)(i.code,{children:"test"})," CD pipeline."]}),"\n",(0,t.jsx)(i.p,{children:(0,t.jsx)(i.img,{src:"https://devtron-public-asset.s3.us-east-2.amazonaws.com/images/global-configurations/filters/filter-icon-pass-1.jpg",alt:"Figure 12a: Filter Icon"})}),"\n",(0,t.jsx)(i.p,{children:(0,t.jsx)(i.img,{src:"https://devtron-public-asset.s3.us-east-2.amazonaws.com/images/global-configurations/filters/conditions-applied-1.jpg",alt:"Figure 12b: Conditions Applied"})}),"\n",(0,t.jsx)(i.h4,{id:"scenario-2",children:"Scenario 2"}),"\n",(0,t.jsxs)(i.p,{children:["Consider another scenario where you wish to make images eligible for deployment only if the application's git branch starts with the word ",(0,t.jsx)(i.code,{children:"hotfix"})," and also if its repo URL matches your specified condition."]}),"\n",(0,t.jsxs)(i.p,{children:[(0,t.jsx)(i.strong,{children:"CEL Expression"}),":"]}),"\n",(0,t.jsx)(i.p,{children:(0,t.jsx)(i.code,{children:"gitCommitDetails.filter(gitCommitDetail, gitCommitDetail.startsWith('https://github.com/devtron-labs')).map(repo, gitCommitDetails[repo].branch).exists_one(branch, branch.startsWith('hotfix-'))"})}),"\n",(0,t.jsxs)(i.p,{children:["where, ",(0,t.jsx)(i.code,{children:"https://github.com/devtron-labs"})," is a portion of the repo URL ",(0,t.jsx)("br",{}),"\nand ",(0,t.jsx)(i.code,{children:"hotfix-"})," is for finding the branch name (say ",(0,t.jsx)(i.em,{children:"hotfix-sept-2024"}),")"]}),"\n",(0,t.jsxs)(i.p,{children:["Alternatively, if you have a fixed branch (say ",(0,t.jsx)(i.em,{children:"hotfix-123"}),"), you may write the following expression:"]}),"\n",(0,t.jsx)(i.p,{children:(0,t.jsx)(i.code,{children:"'hotfix-123' in gitCommitDetails.filter(gitCommitDetail, gitCommitDetail.startsWith('https://github.com/devtron-labs')).map(repo, gitCommitDetails[repo].branch)"})}),"\n",(0,t.jsxs)(i.p,{children:[(0,t.jsx)(i.strong,{children:"Walkthrough Video"}),":"]}),"\n",(0,t.jsx)("div",{class:"video-wrapper",children:(0,t.jsx)("iframe",{width:"560",height:"315",src:"https://www.youtube.com/embed/R8IbZhXhH-k",title:"Filter Condition Example",frameborder:"0",allowfullscreen:!0})}),"\n",(0,t.jsx)(i.h3,{id:"fail-condition",children:"Fail Condition"}),"\n",(0,t.jsxs)(i.p,{children:["Consider a scenario where you wish to exclude an image from deployment if its tag starts with the word ",(0,t.jsx)(i.code,{children:"trial"})," or ends with the word ",(0,t.jsx)(i.code,{children:"testing"})]}),"\n",(0,t.jsxs)(i.p,{children:["The CEL Expression should be ",(0,t.jsx)(i.code,{children:'containerImageTag.startsWith("trial") || containerImageTag.endsWith("testing")'})]}),"\n",(0,t.jsx)(i.p,{children:(0,t.jsx)(i.img,{src:"https://devtron-public-asset.s3.us-east-2.amazonaws.com/images/global-configurations/filters/test-filter-1.jpg",alt:"Figure 13: CEL Expression for Fail Condition"})}),"\n",(0,t.jsxs)(i.p,{children:["Go to the ",(0,t.jsx)(i.strong,{children:"Build & Deploy"})," tab. The filter condition was created specifically for ",(0,t.jsx)(i.code,{children:"devtron-demo"})," environment, therefore the filter condition would be evaluated only at the relevant CD pipeline, i.e., ",(0,t.jsx)(i.code,{children:"devtron-demo"})]}),"\n",(0,t.jsx)(i.p,{children:(0,t.jsx)(i.img,{src:"https://devtron-public-asset.s3.us-east-2.amazonaws.com/images/global-configurations/filters/fail-filter.jpg",alt:"Figure 14: Build & Deploy tab"})}),"\n",(0,t.jsxs)(i.p,{children:["Click ",(0,t.jsx)(i.strong,{children:"Select Image"})," for the ",(0,t.jsx)(i.code,{children:"devtron-demo"})," CD pipeline. The first tab ",(0,t.jsx)(i.strong,{children:"Eligible images"})," shows the list and count of images that have not met the fail condition. Hence, they are marked eligible for deployment."]}),"\n",(0,t.jsx)(i.p,{children:(0,t.jsx)(i.img,{src:"https://devtron-public-asset.s3.us-east-2.amazonaws.com/images/global-configurations/filters/eligible-list-3.jpg",alt:"Figure 15: List of Eligible Images"})}),"\n",(0,t.jsxs)(i.p,{children:["The second tab ",(0,t.jsx)(i.strong,{children:"Latest images"})," shows the latest builds (up to 10 images) irrespective of whether they have satisfied the filter condition(s) or not. The ones that have satisfied the filter conditions get marked as ",(0,t.jsx)(i.code,{children:"Excluded"}),". In other words, they are not eligible for deployment."]}),"\n",(0,t.jsx)(i.p,{children:(0,t.jsx)(i.img,{src:"https://devtron-public-asset.s3.us-east-2.amazonaws.com/images/global-configurations/filters/latest-list-2.jpg",alt:"Figure 16: List of Latest Images"})}),"\n",(0,t.jsxs)(i.p,{children:["Clicking the filter icon at the top-left shows the filter condition(s) applied to the ",(0,t.jsx)(i.code,{children:"devtron-demo"})," CD pipeline."]}),"\n",(0,t.jsx)(i.p,{children:(0,t.jsx)(i.img,{src:"https://devtron-public-asset.s3.us-east-2.amazonaws.com/images/global-configurations/filters/doner-menu-fail-1.jpg",alt:"Figure 17a: Filter Menu Icon"})}),"\n",(0,t.jsx)(i.p,{children:(0,t.jsx)(i.img,{src:"https://devtron-public-asset.s3.us-east-2.amazonaws.com/images/global-configurations/filters/conditions-applied-3.jpg",alt:"Figure 17b: Conditions Applied"})})]})}function h(e={}){const{wrapper:i}={...(0,o.R)(),...e.components};return i?(0,t.jsx)(i,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},8453:(e,i,n)=>{n.d(i,{R:()=>r,x:()=>l});var s=n(6540);const t={},o=s.createContext(t);function r(e){const i=s.useContext(o);return s.useMemo(function(){return"function"==typeof e?e(i):{...i,...e}},[i,e])}function l(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),s.createElement(o.Provider,{value:i},e.children)}}}]);